<!DOCTYPE html>
<html lang="zh-Hans"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦 | 编程技术｜运维技术｜建站技巧｜后端开发｜前端开发｜知识库｜免费资源</title>

    
  
    <link href="/img/personal/avatar.png" rel="icon" type="image/x-icon" />
  


<link rel="canonical" href="https://googhub.nyc.mn/posts/2025/langgraph-%E5%AE%9E%E6%88%983-%E6%AD%A5%E6%90%AD%E5%BB%BA-agent-%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E6%89%8B%E6%90%93%E7%97%9B%E8%8B%A6/" />



<meta name="author" content="Sherry" />
<meta name="description" content="本文面向 AI 开发初学者与刚入门工程师，聚焦复杂 Agent 开发的核心痛点 —— 手搓代码时流程控制混乱、状态管理繁琐、工具集成低效，以开发者从 “手搓党” 到 LangGraph “真香” 的真实经历为线索，系统拆解 LangGraph 的核心价值与实操方法" />


<meta name="keywords" content="技术,LangChain">



<meta name="generator" content="Hugo 0.148.2">


<meta property="og:url" content="https://googhub.nyc.mn/posts/2025/langgraph-%E5%AE%9E%E6%88%983-%E6%AD%A5%E6%90%AD%E5%BB%BA-agent-%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E6%89%8B%E6%90%93%E7%97%9B%E8%8B%A6/">
  <meta property="og:site_name" content="编程技术｜运维技术｜建站技巧｜后端开发｜前端开发｜知识库｜免费资源">
  <meta property="og:title" content="LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦">
  <meta property="og:description" content="本文面向 AI 开发初学者与刚入门工程师，聚焦复杂 Agent 开发的核心痛点 —— 手搓代码时流程控制混乱、状态管理繁琐、工具集成低效，以开发者从 “手搓党” 到 LangGraph “真香” 的真实经历为线索，系统拆解 LangGraph 的核心价值与实操方法">
  <meta property="og:locale" content="zh_Hans">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-25T00:00:00+00:00">
    <meta property="article:tag" content="技术">
    <meta property="article:tag" content="LangChain">
    <meta property="og:image" content="https://googhub.nyc.mn/img/global-background.jpg">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2025/ai-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8D%95%E6%9C%BA%E5%8D%95%E5%8D%A1%E5%BE%AE%E8%B0%83-unsloth-%E5%AE%9E%E6%88%98/">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2025/ai-%E7%A0%94%E5%8F%91%E5%85%A8%E6%A0%88%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2024/%E6%80%8E%E4%B9%88%E8%AE%A9hugo%E6%94%AF%E6%8C%81markdown-%E6%B5%81%E7%A8%8B%E5%9B%BE/">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2024/docker-%E4%B8%8E-podman-%E6%B7%B1%E5%BA%A6%E5%AF%B9%E6%AF%94%E5%AE%B9%E5%99%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E7%9A%84%E5%85%A8%E6%96%B9%E4%BD%8D%E8%A7%A3%E6%9E%90/">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2024/%E6%88%91%E8%AE%A9%E6%89%A3%E5%AD%90%E7%A9%BA%E9%97%B4%E5%B8%AE%E6%88%91%E9%A2%84%E6%B5%8B%E6%B2%AA%E6%B7%B1300%E7%9A%84%E6%98%8E%E6%97%A5%E8%B4%AD%E4%B9%B0%E7%AD%96%E7%95%A5/">
      <meta property="og:see_also" content="https://googhub.nyc.mn/posts/2024/%E4%BB%8Eapi-key%E5%88%B0%E6%99%BA%E8%83%BD%E5%AF%B9%E8%AF%9D%E5%9F%BA%E4%BA%8Elangchain%E7%9A%84%E6%B5%81%E5%BC%8F%E8%81%8A%E5%A4%A9%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://googhub.nyc.mn/img/global-background.jpg">
  <meta name="twitter:title" content="LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦">
  <meta name="twitter:description" content="本文面向 AI 开发初学者与刚入门工程师，聚焦复杂 Agent 开发的核心痛点 —— 手搓代码时流程控制混乱、状态管理繁琐、工具集成低效，以开发者从 “手搓党” 到 LangGraph “真香” 的真实经历为线索，系统拆解 LangGraph 的核心价值与实操方法">
      <meta name="twitter:site" content="@dgdghub">




  

<link rel="stylesheet" href="/css/output.min.css" />




    
    <style>
         
        #loading {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .loader {
            width: 250px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: helvetica, arial, sans-serif;
            text-transform: uppercase;
            font-weight: 900;
            color: #00a96e;
            letter-spacing: 0.2em;
            user-select: none;
        }

        .loader::before,
        .loader::after {
            content: "";
            display: block;
            width: 15px;
            height: 15px;
            background: #00a96e;
            position: absolute;
            animation: load .7s infinite alternate ease-in-out;
            will-change: left, height, width;
        }

        .loader::before {
            top: 0
        }

        .loader::after {
            bottom: 0
        }

        @keyframes load {
            0% {
                left: 0;
                height: 30px;
                width: 15px
            }

            50% {
                height: 8px;
                width: 40px
            }

            100% {
                left: 235px;
                height: 30px;
                width: 15px
            }
        }

         
        #loading, #load-loading, .load-loading {
            justify-content: center;
            align-items: center;
            display: -webkit-box;
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999999;
            background: #fff;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            pointer-events: auto;
        }

        .load-loading {
            position: absolute;
            background: transparent
        }

        .load-loading .bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #000;
            opacity: 0.2
        }

        #load-loading {
            opacity: 0
        }

        #loading.close {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none;
        }

        .io-black-mode #loading,
        .io-black-mode #load-loading {
            background: #111;
        }

        @media (prefers-reduced-motion: reduce) {
            .loader::before,
            .loader::after {
                animation: none;
            }

            #loading, #load-loading, .load-loading {
                transition: none;
            }
        }
    </style>

    
    <div id="loading" role="progressbar" aria-label="页面加载中">
        <div class="loader">AiEDU</div>
    </div>

    <script>
        
        (function() {
            const loadingScreen = document.getElementById('loading');
            if (!loadingScreen) return;

            function hideLoadingScreen() {
                if (!loadingScreen.classList.contains('close')) {
                    loadingScreen.classList.add('close');

                    
                    setTimeout(() => {
                        if (loadingScreen.parentNode) {
                            loadingScreen.parentNode.removeChild(loadingScreen);
                        }
                    }, 500);
                }
            }

            
            window.addEventListener('load', function() {
                const delay = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 0 : 300;
                setTimeout(hideLoadingScreen, delay);
            });

            
            window.addEventListener('beforeunload', function() {
                loadingScreen.classList.remove('close');
            });

            
            if (window.pjax) {
                document.addEventListener('pjax:send', function() {
                    loadingScreen.classList.remove('close');
                });

                document.addEventListener('pjax:complete', function() {
                    const delay = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 0 : 300;
                    setTimeout(hideLoadingScreen, delay);
                });
            }

            
            setTimeout(hideLoadingScreen, 8000);
        })();
    </script>





    


<link rel="stylesheet" data-custom-syntax-highlighting />
<style>
  .chroma {
    padding: 1em;
    background-color: var(--dream-pre-bg, #f5f5f5);
    border-radius: .5em;
    overflow: auto;
  }

  html.dark .chroma {
    background-color: var(--dream-pre-bg-dark, #262626);
  }
</style>









    
    <link rel="stylesheet" href="/css/custom.css" />
    

    
    <script defer src="/js/cdn.min.js"></script>
  </head>

  <body x-data="{
    flip: false,
  }" oncopy="return false" oncut="return false" onpaste="return false">
    
    <div id="dream-global-bg"></div>

    

  
  <nav x-data="{ isSticky: false }"
    x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })"
    class="sticky top-0 z-30 mt-4 lg:mt-8 py-4"
    :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }">
  
    
    <div class="container px-4">
    
      <div class="flex items-center justify-between w-full">
        
        <section class="flex items-center gap-4">
          <div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title="翻转一下！">
            <div class="h-10 rounded-full">
              <img src="/img/personal/avatar.png" alt="AiEDU | BLOG" />
            </div>
          </div>
          
          <div>
            
            <a href="/" class="text-lg font-semibold cursor-pointer">
              AiEDU | BLOG
            </a>
            
            
            <div class="text-base-content/60 text-sm">AI 赋能，智启教育</div>
            
          </div>
          
        </section>

        
        

<style>
   
  .category-nav-container {
    @apply hidden md:flex items-end justify-center gap-2 px-4 !important;
    height: 100%;
  }
</style>


<div class="category-nav-container">
  
  <a
    href="/categories/%E7%BC%96%E7%A8%8B/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="编程"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    编程
  </a>
  
  <a
    href="/categories/vps/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="vps"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    VPS
  </a>
  
  <a
    href="/categories/ai/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="ai"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    AI
  </a>
  
  <a
    href="/categories/devops/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="devops"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    DEVOPS
  </a>
  
  <a
    href="/categories/%E7%9F%A5%E8%AF%86%E5%BA%93/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="知识库"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    知识库
  </a>
  
  <a
    href="/categories/it/"
    class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
    title="it"
    style="
      font-size: 1rem !important;
      margin: 0 0.5rem !important; /* 左右间距0.5rem，上下0 */
      border-radius: 9999px !important; /* 强制圆形 */
    "
  >
    IT
  </a>
  
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const mobileMenu = document.querySelector('.dropdown-content.menu');
  if (mobileMenu) {
    const divider = document.createElement('li');
    divider.innerHTML = '<hr class="my-1 border-base-content/20">';
    mobileMenu.appendChild(divider);

    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/%E7%BC%96%E7%A8%8B\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        编程
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/vps\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        VPS
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/ai\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        AI
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/devops\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        DEVOPS
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/%E7%9F%A5%E8%AF%86%E5%BA%93\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        知识库
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
    
    var categoryItem = document.createElement('li');
    categoryItem.innerHTML = `
      <a
        href="\/categories\/it\/"
        class="badge h-6 no-underline text-gray-800 bg-green-100 hover:badge-primary hover:text-white rounded-full py-1.5 px-3.5 mx-2 transition-all duration-200 ease-in-out text-uppercase !important"
        style="
          font-size: 1rem !important;
          border-radius: 9999px !important;
        "
      >
        IT
      </a>
    `;
    mobileMenu.appendChild(categoryItem);
    
  }
});
</script>


        
        <div class="flex items-center">
          <div class="dropdown dropdown-end sm:hidden">
            <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
              <ion-icon name="menu" class="text-2xl"></ion-icon>
            </div>
            <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md">
              
              
                
              
              






<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/" target="" title="首页">
    
    <ion-icon name="home"></ion-icon>
    
    首页
  </a>
</li>





<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="所有分类">
    <ion-icon name="grid"></ion-icon>
    所有分类
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="所有标签">
    <ion-icon name="pricetags"></ion-icon>
    所有标签
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="归档">
    <ion-icon name="archive"></ion-icon>
    归档
  </a>
</li>







<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="https://www.518855.xyz" target="" title="导航">
    
    <ion-icon name="rocket"></ion-icon>
    
    导航
  </a>
</li>








<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="https://cici.pp.ua" target="" title="文档">
    
    <ion-icon name="documents"></ion-icon>
    
    文档
  </a>
</li>





<li>
  <a class="group inline-flex items-center p-2 cursor-pointer" href="/search" title="搜索">
    <ion-icon name="search"></ion-icon>
    搜索
  </a>
</li>







<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="https://github.com/88899" target="" title="GitHub">
    
    <ion-icon name="logo-github"></ion-icon>
    
    GitHub
  </a>
</li>









<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="关于">
    <ion-icon name="information-circle"></ion-icon>关于</div>
</li>



























            </ul>
          </div>
          <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
            
            
              
            
            
              
              



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/" target="" title="首页">
    <ion-icon class="group-hover:text-primary-content" name="home"></ion-icon>
  </a>
  



              
              
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="所有分类">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


              
              
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="所有标签">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


              
              
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="归档">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


              
              



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://www.518855.xyz" target="" title="导航">
    <ion-icon class="group-hover:text-primary-content" name="rocket"></ion-icon>
  </a>
  



              
              



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://cici.pp.ua" target="" title="文档">
    <ion-icon class="group-hover:text-primary-content" name="documents"></ion-icon>
  </a>
  



              
              
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/search" title="搜索">
  <ion-icon class="group-hover:text-primary-content" name="search"></ion-icon>
</a>


              
              



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://github.com/88899" target="" title="GitHub">
    <ion-icon class="group-hover:text-primary-content" name="logo-github"></ion-icon>
  </a>
  



              
              




<div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="关于">关于</div>





              
              
              
















              
            
          </section>
        </div>
      </div>
    </div>
  </nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            
<div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4">


  <div class="lg:col-span-2">
    <article class="mx-auto prose prose-quoteless dark:prose-invert" id="dream-single-post-main" itemscope itemtype="http://schema.org/Article">
      
  <meta itemprop="name" content="LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦">
  <meta itemprop="description" content="本文面向 AI 开发初学者与刚入门工程师，聚焦复杂 Agent 开发的核心痛点 —— 手搓代码时流程控制混乱、状态管理繁琐、工具集成低效，以开发者从 “手搓党” 到 LangGraph “真香” 的真实经历为线索，系统拆解 LangGraph 的核心价值与实操方法">
  <meta itemprop="datePublished" content="2025-10-25T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-10-25T00:00:00+00:00">
  <meta itemprop="wordCount" content="6675">
  <meta itemprop="image" content="https://googhub.nyc.mn/img/global-background.jpg">
  <meta itemprop="keywords" content="技术,LangChain">

      <header>
        <h1 itemprop="headline">LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦</h1>
        <p class="text-sm">
          
            <span data-format="luxon">2025-10-25T00:00:00Z</span>
          

          | <span>14分钟阅读</span>

          
          | <span>更新于
            
              <span data-format="luxon">2025-10-25T00:00:00Z</span>
            </span>
          
        </p>

        
        <div class="flex justify-between">
          
            <div class="flex items-center">
  
  <div class="avatar mr-1">
    <div class="w-8 rounded-full">
      <img class="my-0!" src="https://s3.aiedu.qzz.io/website/2025/10/c9636914b0782ae3f9269b50dcb88659.png" alt="Sherry" />
    </div>
  </div>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">Sherry</span>
    
  
  </span>
</div>

          

          <div class="flex items-center gap-2">
  
  

  
  
  
  
    
  
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="" target="_blank" rel="noopener noreferrer"
      title="Share on WeChat">
      <ion-icon class="group-hover:text-primary-content" name="logo-WeChat"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://x.com/intent/post?text=LangGraph%20%e5%ae%9e%e6%88%98%ef%bc%8c3%20%e6%ad%a5%e6%90%ad%e5%bb%ba%20Agent%20%e5%bd%bb%e5%ba%95%e5%91%8a%e5%88%ab%e6%89%8b%e6%90%93%e7%97%9b%e8%8b%a6&amp;url=https://googhub.nyc.mn/posts/2025/langgraph-%E5%AE%9E%E6%88%983-%E6%AD%A5%E6%90%AD%E5%BB%BA-agent-%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E6%89%8B%E6%90%93%E7%97%9B%E8%8B%A6/" target="_blank" rel="noopener noreferrer"
      title="Share on X">
      <ion-icon class="group-hover:text-primary-content" name="logo-x"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://facebook.com/sharer/sharer.php?u=https://googhub.nyc.mn/posts/2025/langgraph-%E5%AE%9E%E6%88%983-%E6%AD%A5%E6%90%AD%E5%BB%BA-agent-%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E6%89%8B%E6%90%93%E7%97%9B%E8%8B%A6/" target="_blank" rel="noopener noreferrer"
      title="Share on Facebook">
      <ion-icon class="group-hover:text-primary-content" name="logo-facebook"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://wa.me/?text=LangGraph%20%e5%ae%9e%e6%88%98%ef%bc%8c3%20%e6%ad%a5%e6%90%ad%e5%bb%ba%20Agent%20%e5%bd%bb%e5%ba%95%e5%91%8a%e5%88%ab%e6%89%8b%e6%90%93%e7%97%9b%e8%8b%a6%20https://googhub.nyc.mn/posts/2025/langgraph-%E5%AE%9E%E6%88%983-%E6%AD%A5%E6%90%AD%E5%BB%BA-agent-%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E6%89%8B%E6%90%93%E7%97%9B%E8%8B%A6/" target="_blank" rel="noopener noreferrer"
      title="Share on WhatsApp">
      <ion-icon class="group-hover:text-primary-content" name="logo-whatsapp"></ion-icon>
    </a>
  

  
  
</div>

        </div>
      </header>

      <section id="dream-single-post-content" itemprop="articleBody">
        
          <img class="w-full z-30" src="https://s3.aiedu.qzz.io/website/2025/11/c8dbe35077ef88d2a542df4f656488ee.png" alt="LangGraph 实战，3 步搭建 Agent 彻底告别手搓痛苦" />
        

        <p>在 LangGraph 出现之前，多工具协同 Agent 的开发堪称 “踩坑重灾区”：不仅要手动编写工具调用判断、结果处理、循环终止等胶水代码，逻辑冗余且上线后频繁出现 “漏处理工具结果” 等功能性 bug；用全局变量存储会话状态时，多用户并发场景下极易引发上下文覆盖问题，故障排查往往要耗费大量时间定位根因；更棘手的是新增单一工具（如 “物流查询”），竟需同步修改 5 处以上关联逻辑（判断条件、参数传递、结果拼接），稍有不慎就会引发其他流程的连锁故障。</p>
<p>不少开发者初期都会像我一样，误判框架 “抽象冗余”，执着于手搓代码，总觉得 “几行 Python 就能搞定复杂场景”，却忽视了复杂 Agent 开发的潜在难点，最终陷入被动开发的困境。直到邂逅 LangGraph，才彻底颠覆了这种认知 —— 原来高效开发 Agent 可以如此轻松！</p>
<p>很多开发者初期对框架的抵触情绪，其实都源于相似的顾虑。下面结合我曾经的困惑，聊聊 LangGraph 是如何逐一破解这些难题的。</p>
<h3 id="11-开发者对框架的-3-大核心顾虑">1.1 开发者对框架的 3 大核心顾虑</h3>
<table>
  <thead>
      <tr>
          <th>顾虑点</th>
          <th>具体场景</th>
          <th>手搓代码的 “伪优势”</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>抽象冗余</td>
          <td>调用 LLM 只需简单的 llm.invoke ()，框架却要配置 Chain/Agent 等一系列组件</td>
          <td>代码量少、直观易懂，无需记忆复杂的框架概念</td>
      </tr>
      <tr>
          <td>灵活性不足</td>
          <td>框架固定模板难以定制，比如想在工具调用前增加权限校验，需修改整个链路</td>
          <td>逻辑全由自己掌控，可按需自由调整</td>
      </tr>
      <tr>
          <td>学习成本高</td>
          <td>需花费时间学习框架的 API 和核心概念（如 LangChain 的 Memory/Retriever）</td>
          <td>依托现有 Python 基础即可开发，无需学习新内容</td>
      </tr>
  </tbody>
</table>
<h3 id="12-langgraph-的破局之道">1.2 LangGraph 的破局之道</h3>
<p>当开发者在复杂 Agent 开发中踩坑后就会发现：手搓代码的 “灵活”，在复杂流程下会演变成 “混乱”；而框架的 “抽象”，实则是对重复工作的高效封装。</p>
<p>作为 LangChain 生态的进阶框架，LangGraph 并非简单的 “工具套件”，而是 Agent 的 “流程蓝图”。它通过<strong>图结构</strong>设计，精准解决了手搓代码的 3 大痛点：</p>
<table>
  <thead>
      <tr>
          <th>手搓代码痛点</th>
          <th>LangGraph 解决方案</th>
          <th>实际开发体验</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>流程控制混乱（分支 / 循环逻辑难编写）</td>
          <td>以 “节点 + 边” 定义流程，分支通过条件边实现，循环依靠节点间闭环完成，无需手写 if-else/while 语句</td>
          <td>新增工具调用循环时，仅需添加一条 “工具节点→LLM 节点” 的边，无需修改核心逻辑</td>
      </tr>
      <tr>
          <td>状态管理复杂（会话 / 工具结果易丢失）</td>
          <td>全局 State+Checkpointer 自动存储状态，所有节点共享数据，无需手动传递上下文</td>
          <td>多轮对话无需每次携带历史消息，Checkpointer 可自动从数据库读取之前的状态</td>
      </tr>
      <tr>
          <td>工具集成繁琐（参数解析 / 结果处理耗时）</td>
          <td>内置 ToolNode 自动解析 LLM 的工具调用指令，省去 “提取工具名 + 参数” 的冗余代码</td>
          <td>新增工具只需添加 @tool 装饰器，框架会自动处理后续调用逻辑</td>
      </tr>
  </tbody>
</table>
<h2 id="二3-分钟吃透-langgraph-核心概念图结构-agent-入门">二、3 分钟吃透 LangGraph 核心概念：图结构 Agent 入门</h2>
<p>提到 “图结构”，新手无需畏惧。其实本质就是将 Agent 的工作拆解为 “最小功能单元（节点）”，明确这些单元的执行顺序（边），再搭配一个 “全局数据桶（State）”，就能构建出高效的 Agent 系统。</p>
<h3 id="21-核心三要素statenodeedge必学基础">2.1 核心三要素：State、Node、Edge（必学基础）</h3>
<p>这三个要素是 LangGraph 的基石，理解它们后，后续代码开发会事半功倍。</p>
<h4 id="211-stateagent-的-全局数据桶">2.1.1 State：Agent 的 “全局数据桶”</h4>
<ul>
<li><strong>核心作用</strong>：存储 Agent 运行时的所有数据，包括对话历史、工具结果、用户配置等，所有节点均可对其进行读写操作。</li>
<li><strong>本质属性</strong>：一个带类型约束的字典（通过 TypedDict 定义），新手可直接参考模板编写。</li>
<li><strong>关键细节</strong>：借助 add_messages 注解能自动追加对话历史，有效避免手搓代码时 “覆盖历史消息” 的低级错误。</li>
</ul>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 新手可直接复用的State定义模板</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing_extensions <span style="color:#ff79c6">import</span> TypedDict
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Annotated
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph.message <span style="color:#ff79c6">import</span> add_messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">AgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 对话历史：add_messages自动处理消息追加，无需手动执行list.append()</span>
</span></span><span style="display:flex;"><span>    messages: Annotated[<span style="color:#8be9fd;font-style:italic">list</span>, add_messages]
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 可选：添加迭代计数器（用于防止无限循环）</span>
</span></span><span style="display:flex;"><span>    iteration_count: <span style="color:#8be9fd;font-style:italic">int</span>  <span style="color:#6272a4"># 后续踩坑指南会具体用到</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="212-nodeagent-的-功能单元">2.1.2 Node：Agent 的 “功能单元”</h4>
<ul>
<li><strong>核心作用</strong>：封装具体业务逻辑（如调用 LLM、执行工具、处理数据），输入为 State，输出为更新后的 State。</li>
<li><strong>常见类型</strong>：
<ol>
<li>LLM 节点：调用大模型生成回答或工具指令（例如 “判断是否需要查询天气”）；</li>
<li>工具节点：执行外部工具（例如调用搜索接口、查询数据库）；</li>
<li>决策节点：判断流程下一步的执行节点（与条件边配合使用）。</li>
</ol>
</li>
</ul>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 示例：LLM节点（新手可直接复用）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 初始化LLM（可替换为讯飞、百度等其他模型）</span>
</span></span><span style="display:flex;"><span>llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4o-mini&#34;</span>, api_key<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;你的密钥&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">llm_node</span>(state: AgentState):
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 1. 从State中读取对话历史</span>
</span></span><span style="display:flex;"><span>    history <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 2. 调用LLM生成结果</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke(history)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 3. 返回更新后的State（仅修改messages和计数器）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [result],  <span style="color:#6272a4"># add_messages会自动完成消息追加</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>  <span style="color:#6272a4"># 迭代计数器加1</span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="213-edgeagent-的-流程导航">2.1.3 Edge：Agent 的 “流程导航”</h4>
<ul>
<li><strong>核心作用</strong>：定义节点之间的执行顺序，主要分为两种类型：</li>
</ul>
<table>
  <thead>
      <tr>
          <th>边类型</th>
          <th>核心作用</th>
          <th>适用场景</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>普通边（Add Edge）</td>
          <td>固定跳转逻辑，例如 “START→LLM 节点”</td>
          <td>无需判断的线性流程（如简单聊天机器人）</td>
      </tr>
      <tr>
          <td>条件边（Add Conditional Edges）</td>
          <td>根据 State 数据动态调整跳转路径</td>
          <td>分支 / 循环场景（如 “LLM 需调用工具则跳转至工具节点，否则结束流程”）</td>
      </tr>
  </tbody>
</table>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 示例：条件边的路由函数（判断是否需要调用工具）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">tool_route</span>(state: AgentState) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 1. 读取LLM的最新输出结果</span>
</span></span><span style="display:flex;"><span>    last_msg <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 2. 防止无限循环：迭代次数超过5次则强制结束流程</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">5</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>  <span style="color:#6272a4"># LangGraph内置的“结束节点”标识</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 3. 判断LLM是否存在工具调用需求</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> last_msg<span style="color:#ff79c6">.</span>tool_calls:  <span style="color:#6272a4"># 当LLM输出包含tool_calls字段时，说明需要调用工具</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;tool_node&#34;</span>  <span style="color:#6272a4"># 跳转至工具节点</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>  <span style="color:#6272a4"># 无需调用工具则结束流程</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-langgraph-vs-手搓代码核心优势对比">2.2 LangGraph vs 手搓代码：核心优势对比</h3>
<table>
  <thead>
      <tr>
          <th>能力维度</th>
          <th>手搓代码</th>
          <th>LangGraph</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>流程控制</td>
          <td>依赖 if-else/while 语句，复杂流程下代码臃肿杂乱</td>
          <td>图结构可视化呈现，分支 / 循环通过 “节点 + 边” 实现，修改流程无需改动核心逻辑</td>
      </tr>
      <tr>
          <td>状态管理</td>
          <td>手动传递上下文或存储至数据库，易出现漏传、数据冲突问题</td>
          <td>全局 State+Checkpointer 自动管理状态，多用户通过 thread_id 实现隔离</td>
      </tr>
      <tr>
          <td>工具集成</td>
          <td>需手动编写提示词引导 LLM 输出工具格式，并自行解析结果</td>
          <td>bind_tools 自动生成提示词，ToolNode 负责解析执行，全程无需手动干预</td>
      </tr>
      <tr>
          <td>调试效率</td>
          <td>依赖 print 日志排查问题，流程处于 “黑箱” 状态</td>
          <td>支持生成 Mermaid 可视化流程图，通过 Time Travel 功能回溯历史状态</td>
      </tr>
  </tbody>
</table>
<h2 id="三实操指南3-步搭建可落地的-agent附完整代码">三、实操指南：3 步搭建可落地的 Agent（附完整代码）</h2>
<p>新手建议按 “基础聊天→工具集成→记忆功能” 的顺序逐步推进，每一步都能独立运行，快速建立开发信心。首先完成环境准备：</p>
<p>bash</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># 安装依赖（新手可直接复制执行）</span>
</span></span><span style="display:flex;"><span>pip install langgraph langchain-openai typing-extensions sqlite3 python-dotenv
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="31-第一步构建基础聊天机器人理解图结构">3.1 第一步：构建基础聊天机器人（理解图结构）</h3>
<p>目标：实现 “用户发消息→LLM 回消息” 的线性流程，掌握 LangGraph 的基础用法。</p>
<h4 id="311-完整代码">3.1.1 完整代码</h4>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing_extensions <span style="color:#ff79c6">import</span> TypedDict
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Annotated
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, START, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph.message <span style="color:#ff79c6">import</span> add_messages
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> dotenv <span style="color:#ff79c6">import</span> load_dotenv  <span style="color:#6272a4"># 用dotenv管理密钥，避免硬编码</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 1. 加载环境变量（新手需在项目根目录创建.env文件，写入OPENAI_API_KEY=你的密钥）</span>
</span></span><span style="display:flex;"><span>load_dotenv()
</span></span><span style="display:flex;"><span>api_key <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>getenv(<span style="color:#f1fa8c">&#34;OPENAI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 2. 定义State（存储对话历史和迭代计数器）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">AgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    messages: Annotated[<span style="color:#8be9fd;font-style:italic">list</span>, add_messages]
</span></span><span style="display:flex;"><span>    iteration_count: <span style="color:#8be9fd;font-style:italic">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 3. 定义LLM节点</span>
</span></span><span style="display:flex;"><span>llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4o-mini&#34;</span>, api_key<span style="color:#ff79c6">=</span>api_key)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">llm_node</span>(state: AgentState):
</span></span><span style="display:flex;"><span>    history <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>]
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke(history)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [result],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 4. 构建图结构</span>
</span></span><span style="display:flex;"><span>graph <span style="color:#ff79c6">=</span> StateGraph(AgentState)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 添加节点：为节点命名并绑定对应函数</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;llm&#34;</span>, llm_node)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义执行路径：START→llm节点→END</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(START, <span style="color:#f1fa8c">&#34;llm&#34;</span>)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;llm&#34;</span>, END)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 5. 编译图结构（生成可执行的Agent）</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#ff79c6">=</span> graph<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 6. 测试运行</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">__name__</span> <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 初始State：对话历史为空，迭代计数器设为0</span>
</span></span><span style="display:flex;"><span>    initial_state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [{<span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;content&#34;</span>: <span style="color:#f1fa8c">&#34;介绍下你自己&#34;</span>}],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 调用Agent获取结果</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke(initial_state)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 打印最终回复（取最后一条消息）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;Agent回复：&#34;</span>, result[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 生成可视化流程图（保存为chat_graph.png，便于直观理解）</span>
</span></span><span style="display:flex;"><span>    agent<span style="color:#ff79c6">.</span>get_graph()<span style="color:#ff79c6">.</span>draw_mermaid_png(output_file_path<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;chat_graph.png&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="312-关键步骤解析">3.1.2 关键步骤解析</h4>
<ul>
<li>运行代码后会生成 chat_graph.png 文件，打开可看到 “START→llm→END” 的线性流程，帮助新手直观理解图结构；</li>
<li>务必使用 dotenv 管理密钥，避免将密钥硬编码在代码中，防止泄露。</li>
</ul>
<h3 id="32-第二步集成工具调用langgraph-核心场景">3.2 第二步：集成工具调用（LangGraph 核心场景）</h3>
<p>目标：实现 “LLM 判断工具调用需求→执行工具→基于工具结果生成回答” 的闭环流程。这是手搓代码最繁琐的场景，也是 LangGraph 的核心优势所在。</p>
<h4 id="321-完整代码基于第一步扩展">3.2.1 完整代码（基于第一步扩展）</h4>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing_extensions <span style="color:#ff79c6">import</span> TypedDict
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Annotated
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, START, END, ToolNode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph.message <span style="color:#ff79c6">import</span> add_messages
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain.tools <span style="color:#ff79c6">import</span> tool
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> dotenv <span style="color:#ff79c6">import</span> load_dotenv
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>load_dotenv()
</span></span><span style="display:flex;"><span>api_key <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>getenv(<span style="color:#f1fa8c">&#34;OPENAI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 1. 定义工具（新手可替换为真实工具，如天气API、搜索接口等）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyTools</span>:
</span></span><span style="display:flex;"><span>    @tool  <span style="color:#6272a4"># 必须添加@tool装饰器，框架才能识别工具</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">google_search</span>(<span style="font-style:italic">self</span>, query: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;用于获取互联网最新信息，例如新闻、天气、实时数据等&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 此处为模拟结果，真实场景需替换为Google Search API调用逻辑</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;【搜索结果】关于&#39;</span><span style="color:#f1fa8c">{</span>query<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;的信息：2025年诺贝尔物理学奖得主是XX团队（模拟数据）&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">code_check</span>(<span style="font-style:italic">self</span>, language: <span style="color:#8be9fd;font-style:italic">str</span>, code: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;检查代码语法错误，支持Python/Java/JavaScript等语言&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 此处为模拟结果，真实场景可集成pylint等工具</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;【代码检查结果】</span><span style="color:#f1fa8c">{</span>language<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">代码无语法错误，逻辑正常（模拟数据）&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 2. 定义State（与第一步保持一致，无需修改）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">AgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    messages: Annotated[<span style="color:#8be9fd;font-style:italic">list</span>, add_messages]
</span></span><span style="display:flex;"><span>    iteration_count: <span style="color:#8be9fd;font-style:italic">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 3. 初始化LLM并绑定工具</span>
</span></span><span style="display:flex;"><span>llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4o-mini&#34;</span>, api_key<span style="color:#ff79c6">=</span>api_key)
</span></span><span style="display:flex;"><span>tools <span style="color:#ff79c6">=</span> [MyTools()<span style="color:#ff79c6">.</span>google_search, MyTools()<span style="color:#ff79c6">.</span>code_check]  <span style="color:#6272a4"># 实例化工具列表</span>
</span></span><span style="display:flex;"><span>llm_with_tools <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>bind_tools(tools)  <span style="color:#6272a4"># 为LLM绑定工具，自动生成工具调用提示词</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 4. 定义节点</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># LLM节点：判断是否需要调用工具</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">llm_node</span>(state: AgentState):
</span></span><span style="display:flex;"><span>    history <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>]
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> llm_with_tools<span style="color:#ff79c6">.</span>invoke(history)  <span style="color:#6272a4"># 使用绑定工具的LLM</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [result],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 工具节点：LangGraph内置ToolNode，自动执行工具调用</span>
</span></span><span style="display:flex;"><span>tool_node <span style="color:#ff79c6">=</span> ToolNode(tools)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 5. 定义条件边（判断流程走向）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">tool_route</span>(state: AgentState) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 防止无限循环</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">5</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 判断LLM是否存在工具调用需求</span>
</span></span><span style="display:flex;"><span>    last_msg <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;tool_node&#34;</span> <span style="color:#ff79c6">if</span> last_msg<span style="color:#ff79c6">.</span>tool_calls <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 6. 构建图结构</span>
</span></span><span style="display:flex;"><span>graph <span style="color:#ff79c6">=</span> StateGraph(AgentState)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 添加节点（LLM节点+工具节点）</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;llm&#34;</span>, llm_node)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;tool_node&#34;</span>, tool_node)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义基础执行路径：START→llm节点</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(START, <span style="color:#f1fa8c">&#34;llm&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义条件边：llm节点根据判断结果跳转至工具节点或结束流程</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>    source<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;llm&#34;</span>,  <span style="color:#6272a4"># 源节点：llm节点</span>
</span></span><span style="display:flex;"><span>    condition<span style="color:#ff79c6">=</span>tool_route,  <span style="color:#6272a4"># 路由判断函数</span>
</span></span><span style="display:flex;"><span>    mapping<span style="color:#ff79c6">=</span>{<span style="color:#f1fa8c">&#34;tool_node&#34;</span>: <span style="color:#f1fa8c">&#34;tool_node&#34;</span>, <span style="color:#f1fa8c">&#34;__end__&#34;</span>: <span style="color:#f1fa8c">&#34;__end__&#34;</span>}  <span style="color:#6272a4"># 路由映射关系</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 工具节点执行完成后，返回至llm节点（形成闭环流程）</span>
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;tool_node&#34;</span>, <span style="color:#f1fa8c">&#34;llm&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 7. 编译并测试</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#ff79c6">=</span> graph<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">__name__</span> <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 测试工具调用场景</span>
</span></span><span style="display:flex;"><span>    tool_test_state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [{<span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;content&#34;</span>: <span style="color:#f1fa8c">&#34;2025年诺贝尔物理学奖得主是谁？需要搜索&#34;</span>}],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result1 <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke(tool_test_state)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;工具调用场景回复：&#34;</span>, result1[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 测试无需工具调用场景</span>
</span></span><span style="display:flex;"><span>    no_tool_test_state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [{<span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;content&#34;</span>: <span style="color:#f1fa8c">&#34;介绍下你自己&#34;</span>}],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result2 <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke(no_tool_test_state)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">无工具场景回复：&#34;</span>, result2[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 生成可视化流程图（查看闭环逻辑）</span>
</span></span><span style="display:flex;"><span>    agent<span style="color:#ff79c6">.</span>get_graph()<span style="color:#ff79c6">.</span>draw_mermaid_png(output_file_path<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tool_agent_graph.png&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="322-核心优势体验">3.2.2 核心优势体验</h4>
<ul>
<li>无需手动编写工具解析代码：ToolNode 会自动识别 LLM 输出的 tool_calls 字段，完成工具调用；</li>
<li>循环流程极简实现：通过 “tool_node→llm” 的边，即可让 Agent 基于工具结果继续思考，无需手写 while 循环；</li>
<li>工具扩展成本低：新增工具时，仅需在 MyTools 类中添加带 @tool 装饰器的方法，无需修改其他逻辑。</li>
</ul>
<h3 id="33-第三步添加记忆功能解决跨轮对话">3.3 第三步：添加记忆功能（解决跨轮对话）</h3>
<p>目标：让 Agent 具备跨轮对话记忆能力（例如用户说 “我叫小明”，后续询问 “我是谁” 时能准确应答）。手搓代码需手动对接数据库，而 LangGraph 通过 Checkpointer 可自动实现记忆管理。</p>
<h4 id="331-完整代码实现会话内短期记忆">3.3.1 完整代码（实现会话内短期记忆）</h4>
<p>python</p>
<p>运行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing_extensions <span style="color:#ff79c6">import</span> TypedDict
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Annotated
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, START, END, ToolNode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph.message <span style="color:#ff79c6">import</span> add_messages
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.checkpoint.sqlite <span style="color:#ff79c6">import</span> SqliteSaver  <span style="color:#6272a4"># 基于SQLite存储状态</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain.tools <span style="color:#ff79c6">import</span> tool
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> dotenv <span style="color:#ff79c6">import</span> load_dotenv
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> sqlite3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>load_dotenv()
</span></span><span style="display:flex;"><span>api_key <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>getenv(<span style="color:#f1fa8c">&#34;OPENAI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 1. 工具定义（与第二步保持一致，无需修改）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyTools</span>:
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">google_search</span>(<span style="font-style:italic">self</span>, query: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;【搜索结果】关于&#39;</span><span style="color:#f1fa8c">{</span>query<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;的信息：2025年诺贝尔物理学奖得主是XX团队（模拟数据）&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 2. State定义（与之前保持一致）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">AgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    messages: Annotated[<span style="color:#8be9fd;font-style:italic">list</span>, add_messages]
</span></span><span style="display:flex;"><span>    iteration_count: <span style="color:#8be9fd;font-style:italic">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 3. LLM和节点定义（与第二步保持一致）</span>
</span></span><span style="display:flex;"><span>llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4o-mini&#34;</span>, api_key<span style="color:#ff79c6">=</span>api_key)
</span></span><span style="display:flex;"><span>tools <span style="color:#ff79c6">=</span> [MyTools()<span style="color:#ff79c6">.</span>google_search]
</span></span><span style="display:flex;"><span>llm_with_tools <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>bind_tools(tools)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">llm_node</span>(state: AgentState):
</span></span><span style="display:flex;"><span>    history <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>]
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> llm_with_tools<span style="color:#ff79c6">.</span>invoke(history)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [result],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tool_node <span style="color:#ff79c6">=</span> ToolNode(tools)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">tool_route</span>(state: AgentState) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;iteration_count&#34;</span>] <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">5</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;tool_node&#34;</span> <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>tool_calls <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;__end__&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 4. 初始化短期记忆（基于SQLite的Checkpointer）</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 创建SQLite数据库连接（用于存储状态数据）</span>
</span></span><span style="display:flex;"><span>conn <span style="color:#ff79c6">=</span> sqlite3<span style="color:#ff79c6">.</span>connect(<span style="color:#f1fa8c">&#34;agent_memory.db&#34;</span>, check_same_thread<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 初始化Checkpointer：通过SQLite持久化状态</span>
</span></span><span style="display:flex;"><span>memory <span style="color:#ff79c6">=</span> SqliteSaver(conn)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 5. 构建图结构（与第二步保持一致）</span>
</span></span><span style="display:flex;"><span>graph <span style="color:#ff79c6">=</span> StateGraph(AgentState)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;llm&#34;</span>, llm_node)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;tool_node&#34;</span>, tool_node)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(START, <span style="color:#f1fa8c">&#34;llm&#34;</span>)
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_conditional_edges(<span style="color:#f1fa8c">&#34;llm&#34;</span>, tool_route, {<span style="color:#f1fa8c">&#34;tool_node&#34;</span>: <span style="color:#f1fa8c">&#34;tool_node&#34;</span>, <span style="color:#f1fa8c">&#34;__end__&#34;</span>: <span style="color:#f1fa8c">&#34;__end__&#34;</span>})
</span></span><span style="display:flex;"><span>graph<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;tool_node&#34;</span>, <span style="color:#f1fa8c">&#34;llm&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 6. 编译时传入Checkpointer（启用记忆功能）</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#ff79c6">=</span> graph<span style="color:#ff79c6">.</span>compile(checkpointer<span style="color:#ff79c6">=</span>memory)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 7. 测试跨轮对话</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">__name__</span> <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 配置用户标识：通过thread_id隔离不同用户（例如user_001对应小明，user_002对应小红）</span>
</span></span><span style="display:flex;"><span>    user_config <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#34;configurable&#34;</span>: {<span style="color:#f1fa8c">&#34;thread_id&#34;</span>: <span style="color:#f1fa8c">&#34;user_001&#34;</span>}}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 第一轮对话：告知Agent用户姓名</span>
</span></span><span style="display:flex;"><span>    round1_state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [{<span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;content&#34;</span>: <span style="color:#f1fa8c">&#34;我叫小明，你记住了吗？&#34;</span>}],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result1 <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke(round1_state, config<span style="color:#ff79c6">=</span>user_config)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;第一轮回复：&#34;</span>, result1[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 第二轮对话：询问用户姓名（无需携带历史消息，Checkpointer自动读取）</span>
</span></span><span style="display:flex;"><span>    round2_state <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [{<span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;content&#34;</span>: <span style="color:#f1fa8c">&#34;我是谁？&#34;</span>}],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration_count&#34;</span>: <span style="color:#bd93f9">0</span>  <span style="color:#6272a4"># 计数器会从历史状态续接，此处设0不影响</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result2 <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke(round2_state, config<span style="color:#ff79c6">=</span>user_config)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">第二轮回复：&#34;</span>, result2[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="332-长期记忆实现方案生产级场景">3.3.2 长期记忆实现方案（生产级场景）</h4>
<p>若需实现 “跨会话记忆”（例如用户间隔 3 天再次访问，Agent 仍能记住其偏好），LangGraph 内置的 InMemoryStore 无法满足需求（服务重启后数据丢失），建议采用以下方案：</p>
<ul>
<li>短期记忆：分布式场景使用 RedisSaver，单机场景使用 SqliteSaver；</li>
<li>长期记忆：对接外部 RAG 系统（如 Pinecone 向量数据库），在工具函数中调用 RAG 接口获取数据（例如编写 get_user_preference 工具，从 RAG 系统查询用户偏好）。</li>
</ul>
<h2 id="四落地踩坑指南4-个高频问题解决方案">四、落地踩坑指南：4 个高频问题解决方案</h2>
<p>以下是实操过程中遇到的典型问题及解决方案，新手避开这些坑能大幅提升开发效率：</p>
<h3 id="41-坑-1内置-store-无法支撑长期记忆需求">4.1 坑 1：内置 Store 无法支撑长期记忆需求</h3>
<ul>
<li><strong>问题描述</strong>：使用 InMemoryStore 存储长期数据时，服务重启后数据会全部丢失；</li>
<li><strong>解决方案</strong>：生产环境采用 “向量数据库（Pinecone/Milvus）+ LangChain Retriever” 的组合，在工具中调用 RAG 接口获取长期数据，避免依赖 LangGraph 内置 Store。</li>
</ul>
<h3 id="42-坑-2非-openai-模型适配困难">4.2 坑 2：非 OpenAI 模型适配困难</h3>
<ul>
<li><strong>问题描述</strong>：使用讯飞、百度等国内模型或 Llama 3 等开源模型时，llm.bind_tools 功能无法正常使用；</li>
<li><strong>解决方案</strong>：自定义 LLM 类（继承 LangChain 的 BaseChatModel），重写_generate 方法，确保输出格式包含 tool_calls 字段（与 OpenAI 输出格式兼容）。</li>
</ul>
<h3 id="43-坑-3工具调用陷入无限循环">4.3 坑 3：工具调用陷入无限循环</h3>
<ul>
<li><strong>问题描述</strong>：LLM 反复触发工具调用，无法正常结束流程；</li>
<li><strong>解决方案</strong>：在 State 中添加 iteration_count 字段，在条件边的路由函数中设置阈值（如迭代超过 5 次），强制结束流程（参考 3.2 节的 tool_route 函数）。</li>
</ul>
<h3 id="44-坑-4state-数据冗余导致性能下降">4.4 坑 4：State 数据冗余导致性能下降</h3>
<ul>
<li><strong>问题描述</strong>：将工具调用中间日志等临时数据存入 State，导致 LLM 上下文过长，执行效率降低；</li>
<li><strong>解决方案</strong>：State 仅存储 “必须共享的数据”（对话历史、工具结果、核心配置），临时数据在节点函数中生成后直接使用，无需存入 State。</li>
</ul>
<h2 id="五框架选型指南langgraph-vs-主流-agent-框架">五、框架选型指南：LangGraph vs 主流 Agent 框架</h2>
<p>新手在选择框架时容易纠结，以下通过对比不同框架的核心特性，帮助大家按需选型：</p>
<table>
  <thead>
      <tr>
          <th>框架</th>
          <th>核心架构</th>
          <th>核心优势</th>
          <th>主要劣势</th>
          <th>适用场景</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LangGraph</td>
          <td>有向循环图</td>
          <td>流程控制能力强、状态管理高效、调试便捷</td>
          <td>学习成本中等（需理解图结构概念）</td>
          <td>复杂 Agent 开发（多工具协同、长会话、分支循环场景）</td>
      </tr>
      <tr>
          <td>LangChain</td>
          <td>线性流水线</td>
          <td>组件丰富、轻量易用、入门门槛低</td>
          <td>复杂流程需手动编写控制逻辑</td>
          <td>简单场景（单工具调用、快速原型开发）</td>
      </tr>
      <tr>
          <td>AutoGen</td>
          <td>角色化对话网络</td>
          <td>多智能体协作能力突出</td>
          <td>流程结构化弱、调试难度大</td>
          <td>模拟团队协作（如方案编写、代码评审）</td>
      </tr>
      <tr>
          <td>LlamaIndex</td>
          <td>索引驱动 RAG</td>
          <td>非结构化数据检索能力强</td>
          <td>多步骤决策能力薄弱</td>
          <td>知识库问答（如企业文档查询）</td>
      </tr>
  </tbody>
</table>
<h3 id="选型建议">选型建议</h3>
<ul>
<li>开发复杂 Agent（如智能客服、多功能助手）：优先选择 LangGraph；</li>
<li>快速实现简单工具调用功能：使用 LangChain 高效开发；</li>
<li>需多智能体协同工作：选用 AutoGen；</li>
<li>专注于文档问答场景：LlamaIndex 是更优选择。</li>
</ul>
<h2 id="六总结langgraph-的核心价值">六、总结：LangGraph 的核心价值</h2>
<p>从抵触框架到离不开，LangGraph 让我深刻体会到：优秀的框架并非增加开发负担，而是通过封装重复、复杂的工作，让开发者能专注于核心业务逻辑。</p>
<p>它的核心价值可概括为 3 点：</p>
<ol>
<li><strong>流程可视化</strong>：用图结构替代繁琐的条件判断语句，修改流程无需改动核心代码；</li>
<li><strong>状态自动化</strong>：自动完成上下文传递和状态存储，省去手动对接数据库的冗余工作；</li>
<li><strong>工具标准化</strong>：新增工具仅需添加装饰器，框架自动处理解析和调用逻辑。</li>
</ol>
<p>新手无需畏惧 “图结构” 的概念，跟着本文的 3 步实操流程动手实践，就能快速掌握 LangGraph 的使用技巧。相比手搓代码，它能节省至少 50% 的开发时间，可视化调试功能也能大幅提升问题排查效率。</p>



      </section>

      
      <div class="divider"></div>
      <div class="flex flex-col md:flex-row justify-between gap-4 py-4">
        
        <a role="button" class="btn btn-outline h-12" href="/posts/2025/ai-%E7%A0%94%E5%8F%91%E5%85%A8%E6%A0%88%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/" title="AI 研发全栈技术架构设计实战指南">
          <ion-icon name="chevron-back"></ion-icon>
          <div class="inline-flex flex-col items-start">
            <span class="text-base-content/60 text-xs font-normal">上一页</span>
            <span class="max-w-48 truncate">AI 研发全栈技术架构设计实战指南</span>
          </div>
        </a>
        

        
        <a role="button" class="btn btn-outline h-12" href="/posts/2025/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A3%81%E7%9B%98%E6%8E%92%E6%9F%A5%E5%B7%A5%E5%85%B7%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97%E9%9D%9E%E8%BF%90%E7%BB%B4%E4%B9%9F%E8%83%BD%E8%BD%BB%E6%9D%BE%E6%90%9E%E5%AE%9A%E7%A3%81%E7%9B%98%E9%97%AE%E9%A2%98/" title="服务器磁盘排查工具终极指南：非运维也能轻松搞定磁盘问题">
          <div class="inline-flex flex-col items-end">
            <span class="text-base-content/60 text-xs font-normal">下一页</span>
            <span class="max-w-48 truncate">服务器磁盘排查工具终极指南：非运维也能轻松搞定磁盘问题</span>
          </div>
          <ion-icon name="chevron-forward"></ion-icon>
        </a>
        
      </div>
      

      
       

    </article>
  </div>

  <div
    x-data="tocHighlighter()"
    @scroll.window="debouncedScroll"
    class="hidden lg:flex lg:flex-col lg:items-end lg:self-start"
  >
    
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#11-开发者对框架的-3-大核心顾虑">1.1 开发者对框架的 3 大核心顾虑</a></li>
        <li><a href="#12-langgraph-的破局之道">1.2 LangGraph 的破局之道</a></li>
      </ul>
    </li>
    <li><a href="#二3-分钟吃透-langgraph-核心概念图结构-agent-入门">二、3 分钟吃透 LangGraph 核心概念：图结构 Agent 入门</a>
      <ul>
        <li><a href="#21-核心三要素statenodeedge必学基础">2.1 核心三要素：State、Node、Edge（必学基础）</a></li>
        <li><a href="#22-langgraph-vs-手搓代码核心优势对比">2.2 LangGraph vs 手搓代码：核心优势对比</a></li>
      </ul>
    </li>
    <li><a href="#三实操指南3-步搭建可落地的-agent附完整代码">三、实操指南：3 步搭建可落地的 Agent（附完整代码）</a>
      <ul>
        <li><a href="#31-第一步构建基础聊天机器人理解图结构">3.1 第一步：构建基础聊天机器人（理解图结构）</a></li>
        <li><a href="#32-第二步集成工具调用langgraph-核心场景">3.2 第二步：集成工具调用（LangGraph 核心场景）</a></li>
        <li><a href="#33-第三步添加记忆功能解决跨轮对话">3.3 第三步：添加记忆功能（解决跨轮对话）</a></li>
      </ul>
    </li>
    <li><a href="#四落地踩坑指南4-个高频问题解决方案">四、落地踩坑指南：4 个高频问题解决方案</a>
      <ul>
        <li><a href="#41-坑-1内置-store-无法支撑长期记忆需求">4.1 坑 1：内置 Store 无法支撑长期记忆需求</a></li>
        <li><a href="#42-坑-2非-openai-模型适配困难">4.2 坑 2：非 OpenAI 模型适配困难</a></li>
        <li><a href="#43-坑-3工具调用陷入无限循环">4.3 坑 3：工具调用陷入无限循环</a></li>
        <li><a href="#44-坑-4state-数据冗余导致性能下降">4.4 坑 4：State 数据冗余导致性能下降</a></li>
      </ul>
    </li>
    <li><a href="#五框架选型指南langgraph-vs-主流-agent-框架">五、框架选型指南：LangGraph vs 主流 Agent 框架</a>
      <ul>
        <li><a href="#选型建议">选型建议</a></li>
      </ul>
    </li>
    <li><a href="#六总结langgraph-的核心价值">六、总结：LangGraph 的核心价值</a></li>
  </ul>
</nav>
    
  </div>
</div>


            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>
    © 2023 - 2025  -  AiEDU | BLOG
  </p>
  

  
  <p>知识改变命运，AI改变知识</p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="dream-grid dream-grid-about">
  
  
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">关于我</div>

        <div class="prose dark:prose-invert">
          <p>Hi，这里是 <strong>AiEDU</strong> 的博客。<strong>AiEDU</strong> 是我在互联网上经常使用的名字。</p>
<p>我是一个热衷于开源的研发工程师，在这里我会记录一些关于技术等知识。欢迎你通过评论或者邮件与我交流。</p>

        </div>
      </div>
    </article>
  </div>
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">知识共享（Creative Commons）</div>

        <div class="prose dark:prose-invert">
          <p>此网站的所有内容都遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.25rem; text-decoration: underline;">CC BY-NC-SA 4.0<img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a>。</p>
<p>All contents of this website are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.25rem; text-decoration: underline;">CC BY-NC-SA 4.0<img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px; margin-top: 0; margin-bottom: 0;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a>.</p>

        </div>
      </div>
    </article>
  </div>
  
  

  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">社交链接</div>

        <ul class="menu menu-horizontal flex-wrap w-full px-0 [&_ion-icon]:text-lg">
  
  <li>
    <a href="mailto:aiedu985@gmail.com" title="Email">
      <ion-icon name="mail"></ion-icon>
    </a>
  </li>
  

  
  <li>
    <a href="https://github.com/88899" target="_blank" title="GitHub">
      <ion-icon name="logo-github"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://x.com/mykenwayne" target="_blank" title="X">
      <ion-icon name="logo-x"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://www.linkedin.com/in/mykenwayne" target="_blank" title="Linkedin">
      <ion-icon name="logo-linkedin"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://stackoverflow.com/users/5676489/mykenwayne" target="_blank" title="stack overflow">
      <ion-icon name="logo-stackoverflow"></ion-icon>
    </a>
  </li>
  
</ul>

      </div>
    </article>
  </div>
  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>
    © 2023 - 2025  -  AiEDU | BLOG
  </p>
  

  
  <p>知识改变命运，AI改变知识</p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme = "forest"
</script>


  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>

  
  
    
  
  <script src="/js/grid.min.js"></script>




  

<script src="/js/main.min.js"></script>

    


  <script
  src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"
  integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0="
  crossorigin="anonymous"
></script>
<script>
  format()

  function format() {
    document.querySelectorAll('span[data-format="luxon"]').forEach(el => {
      const date = el.textContent

      el.textContent = luxon.DateTime.fromISO(date, { locale: "zh" }).toFormat("yyyy年MM月dd日")
    })
  }
</script>



<script>
    window.customSyntaxHighlighting = {
      light: "/css/syntax-light.min.css",
      dark: "/css/syntax-dark.min.css"
    }

    document.addEventListener('alpine:initialized', () => {
      var isDark = Alpine.store('darkMode').isDark()
      var customSyntaxHighlightingUrl = isDark ? window.customSyntaxHighlighting.dark : window.customSyntaxHighlighting.light

      document
        .querySelector('link[data-custom-syntax-highlighting]')
        .setAttribute('href', customSyntaxHighlightingUrl)
    })
  </script>




  

<script src="/js/toc.min.js"></script>


  
    <script type="module">
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img', {
        background: 'oklch(var(--b1))',
        margin: 24,
      })
    </script>
  






    

    

    

    
    
      

<script async src="https://www.googletagmanager.com/gtag/js?id=G-7QPNK9FQQL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-7QPNK9FQQL');
</script>

    
        
    
<div class="scroll-buttons">
  <button id="scrollToTop" aria-label="滚动到顶部">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 19V5M5 12l7-7 7 7"/>
    </svg>
  </button>
  <button id="scrollToBottom" aria-label="滚动到底部">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 5v14M5 12l7 7 7-7"/>
    </svg>
  </button>
</div>

<style>
.scroll-buttons {
  position: fixed;
  right: 1rem;
  bottom: 1rem;  
  display: flex;
  flex-direction: column;
  gap: 0.6rem;  
  z-index: 99;
}

.scroll-buttons button {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  border: none;
  background-color: #28a745;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  transform: translateY(10px);
  box-shadow: 0 3px 12px rgba(40, 167, 69, 0.4);
}

.scroll-buttons button:hover {
  background-color: #218838;
  transform: translateY(0) scale(1.05);
  box-shadow: 0 4px 15px rgba(40, 167, 69, 0.5);
}

.scroll-buttons button.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

 
@media (max-width: 768px) {
  .scroll-buttons {
    right: 1rem !important;
    bottom: 1rem !important;  
    gap: 0.5rem !important;
  }

  .scroll-buttons button {
    width: 2.2rem !important;
    height: 2.2rem !important;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scrollToTopBtn = document.getElementById('scrollToTop');
  const scrollToBottomBtn = document.getElementById('scrollToBottom');

  const handleScroll = () => {
    scrollToTopBtn.classList.toggle('visible', window.pageYOffset > 200);
    const isNearBottom = (window.innerHeight + window.pageYOffset) >= document.body.offsetHeight - 100;
    scrollToBottomBtn.classList.toggle('visible', !isNearBottom);
  };

  const scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });
  const scrollToBottom = () => window.scrollTo({
    top: document.documentElement.scrollHeight || document.body.scrollHeight,
    behavior: 'smooth'
  });

  window.addEventListener('scroll', handleScroll);
  scrollToTopBtn.addEventListener('click', scrollToTop);
  scrollToBottomBtn.addEventListener('click', scrollToBottom);
  handleScroll();
});
</script>

    
    <script>
  window.difyChatbotConfig = {
    token: 'h2hkg50dPRmb7SaR',
    inputs: {},
    systemVariables: {},
    userVariables: {
      avatar_url: 'https://cdn.jsdelivr.net/gh/dgdghub/dg-pic@main/blog/20250829110345042.png',
      name: 'AiEDU',
    },
  }
</script>
<script src="https://udify.app/embed.min.js" id="h2hkg50dPRmb7SaR" defer></script>

<style>
   
  #dify-chatbot-bubble-button {
    background-color: #28a745 !important;
    position: fixed !important;
    bottom: 1rem !important;  
    right: 1rem !important;  
    z-index: 9999 !important;
    width: 2.5rem !important;  
    height: 2.5rem !important;  
    box-shadow: 0 3px 12px rgba(40, 167, 69, 0.4) !important;
    margin: 0 !important;
    padding: 0 !important;
  }

   
  #dify-chatbot-bubble-window {
    width: 24rem !important;
    height: 70vh !important;
    max-height: 600px !important;
    min-height: 400px !important;
    position: fixed !important;
    bottom: 1rem !important;  
    right: 1rem !important;
    top: auto !important;
    left: auto !important;
    z-index: 9998 !important;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2) !important;
    transform: none !important;
    margin: 0 !important;
    padding: 0 !important;
    background-color: rgba(255, 255, 255, 0.9) !important;
  }

   
  @media (max-width: 768px) {
    #dify-chatbot-bubble-window {
      width: calc(100vw - 2rem) !important;
      height: 65vh !important;
      bottom: 1rem !important;  
      right: 1rem !important;
      left: 1rem !important;
    }

    #dify-chatbot-bubble-button {
      width: 2.2rem !important;
      height: 2.2rem !important;
      bottom: 1rem !important;
      right: 1rem !important;
    }
  }

   
  @supports (padding: env(safe-area-inset-bottom)) {
    #dify-chatbot-bubble-button {
      bottom: calc(1rem + env(safe-area-inset-bottom)) !important;
    }

    #dify-chatbot-bubble-window {
      bottom: calc(6.1rem + env(safe-area-inset-bottom)) !important;
    }

    @media (max-width: 768px) {
      #dify-chatbot-bubble-button {
        bottom: calc(1rem + env(safe-area-inset-bottom)) !important;
      }

      #dify-chatbot-bubble-window {
        bottom: calc(4.3rem + env(safe-area-inset-bottom)) !important;
      }
    }
  }
</style>


    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js" integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin="anonymous"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js" integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin="anonymous"></script>
  </body>
</html>
