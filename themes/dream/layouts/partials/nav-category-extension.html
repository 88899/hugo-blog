{{/* 分类数据处理逻辑（保持不变） */}}
{{ $allCategories := site.Taxonomies.categories.ByCount | default slice }}
{{ $englishCats := slice }}
{{ $chineseCats := slice }}

{{ range where $allCategories "Page" "!=" nil }}
  {{ $name := .Name | default "" }}
  {{ if and $name (findRE "^[A-Za-z]+$" $name) }}
    {{ $englishCats = $englishCats | append . }}
  {{ else if $name }}
    {{ $chineseCats = $chineseCats | append . }}
  {{ end }}
{{ end }}

{{ $sortedEnglish := sort $englishCats "Name" "asc" | default slice }}
{{ $sortedChinese := sort $chineseCats "Name" "asc" | default slice }}
{{ $categories := $sortedEnglish | append $sortedChinese | first 6 }}

{{ if $categories }}
<style>
/* 容器样式（保持不变） */
.category-container {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px 0;
  width: 100%;
  overflow: hidden;
}

/* 标签样式：保留原有属性，仅新增静态横线基础 */
.category-tag {
  color: #666; /* 亮色默认文字 */
  font-size: 1.0rem;
  font-weight: 450;
  margin: 0 16px;
  text-decoration: none;
  white-space: nowrap;
  padding: 2px 0;
  position: relative; /* 伪元素定位基础 */
  /* 强制CPU渲染，禁用所有GPU加速 */
  transform: none !important;
  will-change: none !important;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* 原有交互效果：保持不变（颜色+字重） */
.category-tag:hover, .category-tag.active {
  color: #10b981;
  font-weight: 600;
}

/* 核心修改：去掉过渡动画，改为静态显示/隐藏横线 */
.category-tag::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  width: 0; /* 默认隐藏 */
  height: 1px; /* 横线变细，减少渲染成本 */
  background-color: #10b981;
  /* 移除所有transition，无动态计算 */
}

/* hover/激活时直接显示横线（无动画，零负载） */
.category-tag:hover::after, .category-tag.active::after {
  width: 100%;
}

/* 暗黑模式：进一步简化横线样式，降低计算压力 */
html.dark .category-tag {
  color: #bbb; /* 暗黑默认文字 */
}

html.dark .category-tag:hover, html.dark .category-tag.active {
  color: #4ade80;
}

html.dark .category-tag::after {
  background-color: #4ade80;
  height: 1px; /* 统一细横线，减少对比度计算 */
}

/* 响应式适配（保持不变） */
@media (max-width: 768px) {
  .category-tag {
    margin: 0 10px;
    font-size: 0.9rem;
  }
}
</style>

<div class="category-container">
  {{ $currentPage := . }}
  {{ range $categories }}
    {{ $categoryPage := .Page | default nil }}
    {{ if $categoryPage }}
      {{ $isActive := false }}
      {{ $currentRelPermalink := $currentPage.RelPermalink | lower | default "" }}
      {{ $categoryRelPermalink := $categoryPage.RelPermalink | lower | default "" }}

      {{ if eq $currentPage.Kind "term" }}
        {{ if or (eq $currentRelPermalink $categoryRelPermalink) (eq (lower $currentPage.Title | default "") (lower $categoryPage.Title | default "")) }}
          {{ $isActive = true }}
        {{ end }}
      {{ else if eq $currentPage.Kind "page" }}
        {{ range $currentPage.Params.categories | default slice }}
          {{ $articleCat := site.GetPage (printf "/categories/%s" .) | default nil }}
          {{ if and $articleCat (eq (lower $articleCat.RelPermalink | default "") $categoryRelPermalink) }}
            {{ $isActive = true }}
          {{ end }}
        {{ end }}
      {{ end }}

      <a href="{{ $categoryPage.RelPermalink }}" class="category-tag {{ if $isActive }}active{{ end }}" title="{{ $categoryPage.Name | default "分类" }}">
        {{ $categoryPage.Name | upper | default "UNKNOWN" }}
      </a>
    {{ end }}
  {{ end }}
</div>
{{ end }}