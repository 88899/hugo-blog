{{/* 分类数据处理逻辑（保持不变） */}}
{{ $allCategories := site.Taxonomies.categories.ByCount | default slice }}
{{ $englishCats := slice }}
{{ $chineseCats := slice }}

{{ range where $allCategories "Page" "!=" nil }}
  {{ $name := .Name | default "" }}
  {{ if and $name (findRE "^[A-Za-z]+$" $name) }}
    {{ $englishCats = $englishCats | append . }}
  {{ else if $name }}
    {{ $chineseCats = $chineseCats | append . }}
  {{ end }}
{{ end }}

{{ $sortedEnglish := sort $englishCats "Name" "asc" | default slice }}
{{ $sortedChinese := sort $chineseCats "Name" "asc" | default slice }}
{{ $categories := $sortedEnglish | append $sortedChinese | first 6 }}

{{ if $categories }}
<style>
/* 容器样式：保持不变 */
.category-container {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding: 6px 0 6px 16px;
  width: 100%;
  overflow: hidden;
}

/* 标签样式：终极精简，移除所有潜在渲染触发点 */
.category-tag {
  color: #666; /* 亮色默认文字 */
  font-size: 1.0rem;
  font-weight: 450;
  margin: 0 16px;
  text-decoration: none;
  white-space: nowrap;
  padding: 3px 0 2px; /* 微调内边距，避免边框影响文字对齐 */
  /* 核心修改1：默认无边框，hover时添加边框（彻底避免透明边框渲染） */
  border-bottom: 0 solid transparent;
  /* 核心修改2：移除backface-visibility（冗余且可能触发额外渲染层） */
  transform: none !important;
  will-change: none !important;
  /* 新增：减少文字渲染复杂度，避免与边框切换叠加触发bug */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 交互效果：仅添加边框（无透明→有色切换，仅0→1px宽度变化） */
.category-tag:hover, .category-tag.active {
  color: #10b981;
  border-bottom-width: 1px; /* 仅改变宽度，颜色直接赋值 */
  border-bottom-color: #10b981;
}

/* 暗黑模式：同步精简 */
html.dark .category-tag {
  color: #bbb;
  border-bottom: 0 solid transparent;
}

html.dark .category-tag:hover, html.dark .category-tag.active {
  color: #4ade80;
  border-bottom-width: 1px;
  border-bottom-color: #4ade80;
}

/* 响应式适配：保持不变 */
@media (max-width: 768px) {
  .category-tag {
    margin: 0 10px;
    font-size: 0.9rem;
  }
}
</style>

<div class="category-container">
  {{ $currentPage := . }}
  {{ range $categories }}
    {{ $categoryPage := .Page | default nil }}
    {{ if $categoryPage }}
      {{ $isActive := false }}
      {{ $currentRelPermalink := $currentPage.RelPermalink | lower | default "" }}
      {{ $categoryRelPermalink := $categoryPage.RelPermalink | lower | default "" }}

      {{ if eq $currentPage.Kind "term" }}
        {{ if or (eq $currentRelPermalink $categoryRelPermalink) (eq (lower $currentPage.Title | default "") (lower $categoryPage.Title | default "")) }}
          {{ $isActive = true }}
        {{ end }}
      {{ else if eq $currentPage.Kind "page" }}
        {{ range $currentPage.Params.categories | default slice }}
          {{ $articleCat := site.GetPage (printf "/categories/%s" .) | default nil }}
          {{ if and $articleCat (eq (lower $articleCat.RelPermalink | default "") $categoryRelPermalink) }}
            {{ $isActive = true }}
          {{ end }}
        {{ end }}
      {{ end }}

      <a href="{{ $categoryPage.RelPermalink }}" class="category-tag {{ if $isActive }}active{{ end }}" title="{{ $categoryPage.Name | default "分类" }}">
        {{ $categoryPage.Name | upper | default "UNKNOWN" }}
      </a>
    {{ end }}
  {{ end }}
</div>
{{ end }}